<!doctype html><title>Random passphrase</title>
<h1>Strong Memorable Passphrase Generator</h1>
<p>Expected time left to live: <input type=number value=246 id=yearsInput> years.
<p>Yearly budget of adversaries:
  <input type=number value=10000000 id=costInput> thousand euros.
<p><button id=genBut>Generate passphrase</button>
  <button id=hideBut>Show passphrase</button>
<p><strong>Generated passphrase:</strong>
  <code><output id=passphraseOutput>Awaiting generation</output></code>.
<p>Entropy: <output id=entropyOutput>Awaiting generation</output> bits.

<script src=./browser.js></script>
<script>
  // Lifetime in years of life left, budget in million euros.
  function genpw(params = {lifetime: 246, budget: 10000000}) {
    return new Promise(function(resolve, reject) {
      var entropy = (Math.log(params.budget/12) + Math.log(1000/0.03)
          + Math.log(params.lifetime) + Math.log(365*24*3600/0.005))
        / Math.log(2) + 1;
      passphrase({entropy: entropy}, function(e, s, entr) {
        if (e !== null) { reject(e); return; }
        resolve({passphrase: s, entropy: entr});
      });
    });
  }

  function computepw() {
    genpw({lifetime: +yearsInput.value, budget: +costInput.value})
    .then(function(state) {
      password = state;
      showPasswords();
    }).catch(function(e) {
      console.error('Error generating password:', e);
      alert('Error generating password. Maybe try with another browser.');
    });
  }

  var password = null;

  function showPasswords() {
    if (passphrasesAreHidden) {
      passphraseOutput.textContent = hiddenPassword;
    } else {
      passphraseOutput.textContent = password.passphrase;
    }
    entropyOutput.textContent = password.entropy.toFixed(2);
  }

  var passphrasesAreHidden = true;
  var hiddenPassword = '████████████████████████████';
  function toggleHide() {
    passphrasesAreHidden = !passphrasesAreHidden;
    showPasswords();
  }

  addEventListener('DOMContentLoaded', function() {
    computepw();
    genBut.addEventListener('click', computepw);
    hideBut.addEventListener('click', toggleHide);
  });
</script>
